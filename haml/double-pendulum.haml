!!!
%html
  %head
    %meta{charset: "utf-8"}/
    %meta{content: "chrome=1", "http-equiv" => "X-UA-Compatible"}/
    %meta{content: "width=device-width, initial-scale=1, maximum-scale=1", name: "viewport"}/
    %link{href: "https://fonts.googleapis.com/css?family=Droid+Serif:400italic,400,700italic,700|Arbutus+Slab:400", rel: "stylesheet", type: "text/css"}/
    %link{href: "../assets/stylesheets/fonts.css", rel: "stylesheet", type: "text/css"}/
    %link{href: "../assets/stylesheets/base.css", media: "screen", rel: "stylesheet", type: "text/css"}/
    %link{href: "../assets/stylesheets/code_snippet.css", media: "screen", rel: "stylesheet", type: "text/css"}/
    %script{src: "http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML", type: "text/javascript"}
    %script{type: "text/x-mathjax-config"}
      MathJax.Hub.Config({
      tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
      }
      });
    %title Double Pendulum

  %body
    %header
      .inner
        %h1{style: "margin-bottom: 5px"} Double Pendulum
        %h2{style: "margin-top: 5px;margin-bottom: 30px"} This repo contains simple physics simulations
    #content-wrapper
      .inner.clearfix
        %section#main-content
          %a.anchor{href: "../projects/double-pendulum-sim.html"} Double Pendulum.
          %p
            The Double Pendulum is a simple yet rich physical system. The motion of the pendulums is governed by a pair of coupled differential equations, which we will solve using the Euler method.
            To simulate the system let's first create the methods to draw the balls and the strings that hold them together.
            Now, we have to figure out the way the strings and the balls are going to move, i.e., we need to solve the equations of motion for the system.
            Let's start by expressing the cartesian coordinates of the two pendulums
            $$x_1 = l_1\sin \theta_1$$
            $$y_1 = -l_1\cos \theta_1$$
            $$x_2 = l_1\sin \theta_1 + l_2\sin \theta_2$$
            $$y_2 = -l_1\cos \theta_1 -l_2\cos \theta_2$$
            We will solve the equations of motion in polar coordinates and we are going to use the Lagrangian $L = T- V$ to derive them.
            The Kinetic energy of the system is
            $$T = \frac{1}{2}m_1(\dot{x_1}^2+\dot{y_1}^2)+\frac{1}{2}m_2(\dot{x_2}^2+\dot{y_2}^2)$$
            which expressed in polar coordinates is
            $$T = \frac{1}{2}m_1h_1^2\dot{\theta_1}^2+\frac{1}{2}m_2\left(h_1^2\dot{\theta_1}^2+h_2^2\dot{\theta_2}^2+2h_1h_2\dot{\theta_1}\dot{\theta_2}\cos(\theta_1-\theta_2)\right)$$
            The potential energy of the system is
            $$V = m_1gy_1+m_2gy_2 = -(m_1+m_2)gl_1\cos \theta_1 - m_2 g l_2 \cos \theta_2 $$
            The Lagrange equations for $\theta_1$ and $\theta_2$ are
            $$ \frac{d}{dt}\left(\frac{\partial L}{\partial\dot{\theta_i}}\right) - \frac{\partial L}{\partial \theta_i} = 0 $$
            Working out the details of the two Lagrange equations, we end up with
            $$ \ddot{\theta_1} =\frac{g\left(\sin \theta_2 \cos (\theta_1-\theta_2)- \left(1+\frac{m_1}{m_2}\right)\sin \theta_1\right)-\left(l_2\dot{\theta_1}\dot{\theta_2}+l_1\dot{\theta_1}^2\cos (\theta_1-\theta_2)\right)\sin (\theta_1-\theta_2)}{l_1\left(1+\frac{m_1}{m_2}-\cos^2 (\theta_1-\theta_2)\right)}$$
            $$ \ddot{\theta_2} = \frac{g\left(1+\frac{m_1}{m_2}\right)(\sin \theta_1\cos (\theta_1 - \theta_2) - \sin \theta_2)+\left(\left(1+\frac{m_1}{m_2}\right)l_1\dot{\theta_1}^2+l_2\dot{\theta_2}^2\cos(\theta_1-\theta_2)\right)\sin(\theta_1-\theta_2)}{l_2\left(1+\frac{m_1}{m_2}-\cos^2 (\theta_1-\theta_2)\right)}$$
            Now, to solve the equations of motion for the angles we can use the Euler method. To do that we just have to define a time interval and iterate over time.
            The angular accelerations, velocities and positions for the instant $t+\Delta t$ are all calculated using the same variables in $t$. Once we calculate the new angles we just need to update the positions of the balls and strings and re-draw the elements.


            This is a double pendulum simulation written in less than 100 lines of javscript. Go ahead and play with it
            %a.anchor{href: "../projects/double-pendulum-sim.html"} demo!
            Learn more about the double pendulum on
            = succeed "." do
              %a.anchor{href: "http://en.wikipedia.org/wiki/Double_pendulum"} wikipedia

          %pre
            %code.code
              :preserve
                function drawLine(myLine, context) {
                  context.beginPath();
                  context.moveTo(myLine.x0, myLine.y0);
                  context.lineTo(myLine.x, myLine.y);
                  context.strokeStyle = 'red';
                  context.stroke();
                }
          %pre
            %code.code
              :preserve
                function drawCircle(myCircle, context) {
                  context.beginPath();
                  context.arc(myCircle.x, myCircle.y, myCircle.mass, 0, 2 * Math.PI, false);
                  context.fillStyle = '#000';
                  context.fill();
                  context.lineWidth = 5;
                  context.strokeStyle = 'black';
                  context.stroke();
                }
          %pre
            %code.code
              :preserve
                function animate(myCircle1, myCircle2, myLine1, myLine2, canvas, context) {
                /**/
                  myCircle1.x = X0+l1*Math.sin(Phi1);
                  myCircle1.y = Y0+l1*Math.cos(Phi1);
                  myCircle2.x = X0+l1*Math.sin(Phi1)+l2*Math.sin(Phi2);
                  myCircle2.y = Y0+l1*Math.cos(Phi1)+l2*Math.cos(Phi2);

                  myLine1.x  = myCircle1.x;
                  myLine1.y  = myCircle1.y;
                  myLine2.x0 = myCircle1.x;
                  myLine2.y0 = myCircle1.y;
                  myLine2.x  = myCircle2.x;
                  myLine2.y  = myCircle2.y;

                  context.clearRect(0, 0, canvas.width, canvas.height);

                  drawLine(myLine1, context);
                  drawLine(myLine2, context);
                  drawCircle(myCircle1, context);
                  drawCircle(myCircle2, context);
                }


          %pre
            %code.code
              :preserve
                function run(){
                  var myLine1 = {x0: X0, y0: Y0, x: 0, y: 0};
                  var myLine2 = {x0: 0, y0: 0, x: 0, y: 0};
                  var myCircle1 = {x: X0+l1*Math.sin(Phi1),
                                   y: Y0+l1*Math.cos(Phi1), mass: m1};
                  var myCircle2 = {x: X0+l1*Math.sin(Phi1)+l2*Math.sin(Phi2),
                                   y: Y0+l1*Math.cos(Phi1)+l2*Math.cos(Phi2), mass: m2};

                  clearInterval(init);
                  context.clearRect(0, 0, canvas.width, canvas.height);
                  init = setInterval(function(){
                    animate(myCircle1, myCircle2, myLine1, myLine2, canvas, context);
                  }, 20);
                }
        %aside#sidebar
          %p.repo-owner{style: "margin-top: 50px"}
            Work by
            = succeed "." do
              %a{href: "https://github.com/micaeloliveira"} micaeloliveira
              and
              %a{href: "https://github.com/luisbatalha"} luisbatalha

          %a.button{href: "https://github.com/micaeloliveira/physics-sandbox"}
            %small
              View project on GitHub
